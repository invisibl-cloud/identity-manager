{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Introduction","text":""},{"location":"#introduction","title":"Introduction","text":"<p>Identity Manager Operator is a Kubernetes Operator that automates the creation and management of pod identities.</p>"},{"location":"#what-problem-does-identity-manager-operator-solve","title":"What problem does Identity Manager Operator solve?","text":"<p>When an application running in a Pod needs to connect to a Cloud Service (such as Amazon SQS, Azure Event Hub, Google BigQuery Storage API), it needs API credentials. These API credentials need to be short-lived and fine grained so that a Pod gets only the required permissions. In each cloud provider, this is solved differently:</p> <ul> <li>Amazon EKS</li> <li>IAM Roles for Service Accounts</li> <li>Google GKE</li> <li>Workload Identity</li> <li>Azure AKS</li> <li>Azure AD Pod Identity</li> <li>Azure Workload Identity </li> </ul> <p>Kubernetes administrators have to deal with the following:</p> <ul> <li>Creating fine grained Roles &amp; Policies as per application needs</li> <li>Creating and managing Kubernetes Service Accounts that provides identities to Pods by mapping to specific Roles &amp; Policies</li> </ul> <p>Performing the above activities manually doesn't scale for large environments that comprises of many applications. Applications also evolve rapidly requiring dynamic modification of Service Accounts to provide access to more cloud services.</p> <p>Identity Manager Operator automates the entire lifecycle of creating and managing pod identities. It takes care of the following:</p> <ul> <li>Dynamically creating fine grained IAM Roles &amp; Policies as requested</li> <li>Provisioning Kubernetes Service Accounts</li> <li>Attaching the Kubernetes Service Accounts to Pods</li> </ul>"},{"location":"api-overview/","title":"Overview","text":""},{"location":"api-overview/#architecture","title":"Architecture","text":"<p>The Identity Manager Operator extends Kubernetes with Custom Resources to provide necessary Service Accounts along with required IAM Roles &amp; Policies for pods to connect with Cloud APIs. The controller creates the defined policies in the cloud and maps them to the defined service account. If the desired state is changed, the controller will reconcile the state in the cluster and in the cloud. The supported cloud platforms are AWS and Azure.</p>"},{"location":"api-overview/#workloadidentity","title":"WorkloadIdentity","text":"<p>The WorkloadIdentity resource defines the cloud provider, and the cloud provider's spec. The cloud provider defines the cloud platform for which the policies have to be created. Currently supported cloud providers are AWS and Azure. The Role policies define the policies that the pods require to access to appropriate cloud APIs. The service account defines the service account which is mapped to the defined policies. The WorkloadIdentity resource is namespaced.</p> <p>The working of Identity Manager is possible with an AWS's feature called IRSA.</p>"},{"location":"api-overview/#irsa-iam-roles-for-service-accounts","title":"IRSA - IAM Roles for Service Accounts","text":"<p>IRSA works by associating an IAM role to a service account. This service account can then provide AWS permissions to the containers in any pod that uses that service account. With this feature, there is no need to extend the IAM permissions to the EKS node's IAM role. </p> <p>With IRSA, the pods are made the first class citizens in IAM. Instead of intercepting the requests to the EC2 metadata API to perform a call to the STS API to retrieve temporary credentials, the changes are made in the AWS identity APIs to recognize Kubernetes pods. By combining an OpenID Connect (OIDC) identity provider and Kubernetes service account annotations, the users can use the IAM roles at the pod level.</p> <p>For more information, refer AWS IRSA</p>"},{"location":"api-overview/#behavior","title":"Behavior","text":"<p>This section defines the behavior of the Identity Manager in AWS EKS cluster for the following sample workload identity.  On applying the above workload identity, Identity Manager Operator reconciles the workload identity in the following manner:</p> <ol> <li>The Identity Manager identifies the cloud provider using <code>spec.provider</code>. This also tells the Identity Manager to read the AWS specific spec at <code>spec.aws</code>.</li> <li>The Identity Manager uses specified credentials in <code>spec.credentials</code> to instantiate the cloud provider's API client if the cluster is a non EKS cluster.</li> <li>The Identity Manager creates an IAM role with the name <code>demo-identity</code>, in the path mentioned in <code>spec.aws.path</code> attaches the policies defined in <code>spec.aws.inlinePolicies</code>, applies the trust policy specified in <code>spec.aws.assumeRolePolicy</code> to the IAM role. The created IAM role will have the session duration mentioned in <code>spec.aws.maxSessionDuration</code>. It is the user's responsibility to populate the OIDC provider, namespace and the service account to which the IAM role will be annotated in <code>spec.aws.assumeRolePolicy</code>.</li> <li>The Identity Manager creates or updates the service account depending on the service account action specified in the <code>spec.aws.serviceAccounts.action</code>. The service account creates a new annotation with the newly created IAM role in the service account if the <code>spec.aws.serviceAccounts.action</code> is <code>Create</code>. If <code>spec.aws.serviceAccounts.action</code> is <code>Update</code>, the Identity Manager will update the service account's annotation if necessary. The following shows the example annotation of a service account: <pre><code> annotations:\n    eks.amazonaws.com/role-arn: arn:aws:iam::123248189203:role/demo-identity\n</code></pre></li> <li>Identity manager will use pods.matchLables to verify whether the role is assigned to a pod and it will restart the pods if it is not assigned.</li> <li>The roles and policies and deleted if the workload identity is deleted.</li> </ol>"},{"location":"api-overview/#access-control","title":"Access Control","text":"<p>The Identity Manager Operator runs as a deployment in your cluster with elevated privileges. It will read secrets in all namespaces. Ensure that the credentials you provide give Identity Manager the least privilege necessary.</p>"},{"location":"api-specification/","title":"WorkloadIdentity","text":"<p>Packages:</p> <ul> <li> identity-manager.io/v1alpha1 </li> </ul>"},{"location":"api-specification/#identity-manager.io/v1alpha1","title":"identity-manager.io/v1alpha1","text":"<p> <p>Package v1alpha1 contains resources for identity-manager</p> </p> <p>Resource Types:</p>"},{"location":"api-specification/#identity-manager.io/v1alpha1.AzureIdentity","title":"AzureIdentity","text":"<p> (Appears on: WorkloadIdentityAzure) </p> <p> <p>AzureIdentity is the definition of Azure\u2019s Identity</p> </p> Field Description <code>apiVersion</code>  string  (Optional) <p>APIVersion of the identity</p> <code>kind</code>  string  (Optional) <p>Kind of the identity</p> <code>metadata</code>  Metadata  (Optional) <p>Metadata of the identity</p> <code>spec</code>  AzureIdentitySpec  (Optional) <p>Spec of the identity</p>"},{"location":"api-specification/#identity-manager.io/v1alpha1.AzureIdentityBinding","title":"AzureIdentityBinding","text":"<p> (Appears on: WorkloadIdentityAzure) </p> <p> <p>AzureIdentityBinding is the definition of Azure Identity Binding</p> </p> Field Description <code>apiVersion</code>  string  (Optional) <p>APIVersion of the IdentityBinding</p> <code>kind</code>  string  (Optional) <p>Kind of the IdentityBinding</p> <code>metadata</code>  Metadata  (Optional) <p>Metadata of the IdentityBinding</p> <code>spec</code>  AzureIdentityBindingSpec  (Optional) <p>Spec of the IdentityBinding</p>"},{"location":"api-specification/#identity-manager.io/v1alpha1.AzureIdentityBindingSpec","title":"AzureIdentityBindingSpec","text":"<p> (Appears on: AzureIdentityBinding) </p> <p> <p>AzureIdentityBindingSpec defines the spec of the Identity Binding</p> </p> Field Description <code>selector</code>  string  (Optional) <p>Selector of the IdentityBinding</p>"},{"location":"api-specification/#identity-manager.io/v1alpha1.AzureIdentitySpec","title":"AzureIdentitySpec","text":"<p> (Appears on: AzureIdentity) </p> <p> <p>AzureIdentitySpec defines the spec of the Identity</p> </p> Field Description <code>type</code>  int  (Optional) <p>Type of the identity</p>"},{"location":"api-specification/#identity-manager.io/v1alpha1.Condition","title":"Condition","text":"<p> (Appears on: ConditionedStatus) </p> <p> <p>A Condition that may apply to a resource.</p> </p> Field Description <code>type</code>  ConditionType  <p>Type of this condition. At most one of each condition type may apply to a resource at any point in time.</p> <code>status</code>  Kubernetes core/v1.ConditionStatus  <p>Status of this condition; is it currently True, False, or Unknown?</p> <code>lastTransitionTime</code>  Kubernetes meta/v1.Time  <p>LastTransitionTime is the last time this condition transitioned from one status to another.</p> <code>reason</code>  ConditionReason  <p>A Reason for this condition\u2019s last transition from one status to another.</p> <code>message</code>  string  (Optional) <p>A Message containing details about this condition\u2019s last transition from one status to another, if any.</p>"},{"location":"api-specification/#identity-manager.io/v1alpha1.ConditionReason","title":"ConditionReason (<code>string</code> alias)","text":"<p> (Appears on: Condition) </p> <p> <p>A ConditionReason represents the reason a resource is in a condition.</p> </p> Value Description <p>\"Available\"</p> <p>\"Creating\"</p> <p>\"Deleting\"</p> <p>\"ReconcileError\"</p> <p>\"ReconcileSuccess\"</p> <p>\"Unavailable\"</p>"},{"location":"api-specification/#identity-manager.io/v1alpha1.ConditionType","title":"ConditionType (<code>string</code> alias)","text":"<p> (Appears on: Condition) </p> <p> <p>A ConditionType represents a condition a resource could be in.</p> </p> Value Description <p>\"Ready\"</p> <p>TypeReady resources are believed to be ready to handle work.</p> <p>\"Synced\"</p> <p>TypeSynced resources are believed to be in sync with the Kubernetes resources that manage their lifecycle.</p>"},{"location":"api-specification/#identity-manager.io/v1alpha1.ConditionedStatus","title":"ConditionedStatus","text":"<p> (Appears on: WorkloadIdentityStatus) </p> <p> <p>A ConditionedStatus reflects the observed status of a resource. Only one condition of each type may exist.</p> </p> Field Description <code>conditions</code>  []Condition  (Optional) <p>Conditions of the resource.</p>"},{"location":"api-specification/#identity-manager.io/v1alpha1.Credentials","title":"Credentials","text":"<p> (Appears on: WorkloadIdentitySpec) </p> <p> <p>Credentials defines the credentials of the cloud provider</p> </p> Field Description <code>source</code>  CredentialsSource  (Optional) <p>Source of the credentials</p> <code>secretRef</code>  SecretRef  (Optional) <p>SecretRef to fetch the credentials</p> <code>properties</code>  map[string]string  (Optional) <p>Properties indicates extra properties of credentials</p>"},{"location":"api-specification/#identity-manager.io/v1alpha1.CredentialsSource","title":"CredentialsSource (<code>string</code> alias)","text":"<p> (Appears on: Credentials) </p> <p> <p>A CredentialsSource is a source from which provider credentials may be acquired.</p> </p> Value Description <p>\"Secret\"</p> <p>CredentialsSourceSecret indicates that a provider should acquire credentials from a secret.</p>"},{"location":"api-specification/#identity-manager.io/v1alpha1.ExternalResource","title":"ExternalResource","text":"<p> (Appears on: WorkloadIdentityStatus) </p> <p> <p>ExternalResource is the external resource\u2019s definition</p> </p> Field Description <code>id</code>  string  (Optional) <p>ID of the external resource</p> <code>type</code>  string  (Optional) <p>Type of the external resource</p>"},{"location":"api-specification/#identity-manager.io/v1alpha1.GCPCustomRole","title":"GCPCustomRole","text":"<p> (Appears on: WorkloadIdentityGCP) </p> <p> <p>GCPCustomRole defines Custom Role in GCP</p> </p> Field Description <code>title</code>  string  (Optional) <p>Title of the Role</p> <code>desc</code>  string  (Optional) <p>Desc of the Role</p> <code>permissions</code>  []string  (Optional) <p>Permissions of the Role</p> <code>stage</code>  string  (Optional) <p>Stage of the Role</p>"},{"location":"api-specification/#identity-manager.io/v1alpha1.GCPExpr","title":"GCPExpr","text":"<p> <p>GCPExpr defines expr for Role</p> </p> Field Description <code>description</code>  string  <p>Description: Optional. Description of the expression. This is a longer text which describes the expression, e.g. when hovered over it in a UI.</p> <code>expression</code>  string  <p>Expression: Textual representation of an expression in Common Expression Language syntax.</p> <code>location</code>  string  <p>Location: Optional. String indicating the location of the expression for error reporting, e.g. a file name and a position in the file.</p> <code>title</code>  string  <p>Title: Optional. Title for the expression, i.e. a short string describing its purpose. This can be used e.g. in UIs which allow to enter the expression.</p>"},{"location":"api-specification/#identity-manager.io/v1alpha1.Metadata","title":"Metadata","text":"<p> (Appears on: AzureIdentity,  AzureIdentityBinding) </p> <p> <p>Metadata defines kubernetes resource\u2019s metadata</p> </p> Field Description <code>name</code>  string  (Optional) <p>Name of the Resource</p> <code>namespace</code>  string  (Optional) <p>Namespace of the Resource</p> <code>labels</code>  map[string]string  (Optional) <p>Labels of the Resource</p> <code>annotations</code>  map[string]string  (Optional) <p>Annotations of the Resource</p>"},{"location":"api-specification/#identity-manager.io/v1alpha1.PodSelector","title":"PodSelector","text":"<p> <p>PodSelector defines the pod selector</p> </p> Field Description <code>LabelSelector</code>  Kubernetes meta/v1.LabelSelector  <p> (Members of <code>LabelSelector</code> are embedded into this type.) </p> <code>namespace</code>  string  (Optional) <p>Namespace of the Pod</p>"},{"location":"api-specification/#identity-manager.io/v1alpha1.Provider","title":"Provider (<code>string</code> alias)","text":"<p> (Appears on: WorkloadIdentitySpec) </p> <p> <p>Provider defines the cloud provider of the WorkloadIdentity</p> </p> Value Description <p>\"AWS\"</p> <p>ProviderAWS is the AWS provider.</p> <p>\"Azure\"</p> <p>ProviderAzure is the Azure provider.</p> <p>\"GCP\"</p> <p>ProviderGCP is the GCP provider.</p>"},{"location":"api-specification/#identity-manager.io/v1alpha1.Resource","title":"Resource","text":"<p> (Appears on: WorkloadIdentityStatus) </p> <p> <p>Resource is the definition of the kubernetes resource</p> </p> Field Description <code>apiVersion</code>  string  (Optional) <p>APIVersion of the resource</p> <code>kind</code>  string  (Optional) <p>Kind of the resource</p> <code>name</code>  string  (Optional) <p>Name of the resource</p> <code>namespace</code>  string  (Optional) <p>Namespace of the resource</p>"},{"location":"api-specification/#identity-manager.io/v1alpha1.RoleAssignment","title":"RoleAssignment","text":"<p> (Appears on: WorkloadIdentityAzure) </p> <p> <p>RoleAssignment defines the role assignment</p> </p> Field Description <code>role</code>  string  <p>Role of the role assignment</p> <code>scope</code>  string  (Optional) <p>Scope of the role assignment</p>"},{"location":"api-specification/#identity-manager.io/v1alpha1.RoleDefinition","title":"RoleDefinition","text":"<p> <p>RoleDefinition is the definition for a Role</p> </p> Field Description <code>id</code>  string  <p>ID of the role definition (this will be used to generate internal UUID for role)</p> <code>roleName</code>  string  <p>RoleName of the role definition</p> <code>roleType</code>  string  <p>RoleType of the role definition</p> <code>description</code>  string  (Optional) <p>Description of the role definition</p> <code>assignableScopes</code>  []string  (Optional) <p>AssignableScopes is a list of assignable scopes</p> <code>permissions</code>  []RolePermission  <p>Permissions of the role definition</p>"},{"location":"api-specification/#identity-manager.io/v1alpha1.RolePermission","title":"RolePermission","text":"<p> (Appears on: RoleDefinition) </p> <p> <p>RolePermission defines the permissions of a Role</p> </p> Field Description <code>actions</code>  []string  (Optional) <p>Actions is a list of actions</p> <code>notActions</code>  []string  (Optional) <p>NotActions is a list of not actions</p> <code>dataActions</code>  []string  (Optional) <p>DataActions is a list of data actions</p> <code>notDataActions</code>  []string  (Optional) <p>NotDataActions is a list of not data actions</p>"},{"location":"api-specification/#identity-manager.io/v1alpha1.SecretRef","title":"SecretRef","text":"<p> (Appears on: Credentials) </p> <p> <p>SecretRef defines the reference to the secret</p> </p> Field Description <code>namespace</code>  string  (Optional) <p>Namespace of the secret.</p> <code>name</code>  string  <p>Name of the secret.</p>"},{"location":"api-specification/#identity-manager.io/v1alpha1.ServiceAccount","title":"ServiceAccount","text":"<p> <p>ServiceAccount defines the service account\u2019s metadata</p> </p> Field Description <code>action</code>  ServiceAccountAction  <p>Action to be perform on ServiceAccount</p> <code>name</code>  string  (Optional) <p>Name of the ServiceAccount</p> <code>namespace</code>  string  (Optional) <p>Namespace of the ServiceAccount</p> <code>Annotations</code>  map[string]string  (Optional) <p>Annotations to be added on ServiceAccount</p>"},{"location":"api-specification/#identity-manager.io/v1alpha1.ServiceAccountAction","title":"ServiceAccountAction (<code>string</code> alias)","text":"<p> (Appears on: ServiceAccount) </p> <p> <p>A ServiceAccountAction indicates action to be perform on ServiceAccount</p> </p> Value Description <p>\"Create\"</p> <p>ServiceAccountActionCreate indicates create service account</p> <p>\"\"</p> <p>ServiceAccountActionDefault indicates no action</p> <p>\"Update\"</p> <p>ServiceAccountActionUpdate indicates updating service account</p>"},{"location":"api-specification/#identity-manager.io/v1alpha1.SyncKey","title":"SyncKey","text":"<p> <p>SyncKey is the sync key\u2019s definition</p> </p> Field Description <code>source</code>  SyncKeySource  (Optional) <p>Source of the sync key</p> <code>params</code>  map[string]string  (Optional) <p>Parameters of the sync key</p> <code>writeToSecretRef</code>  WriteToSecretRef  (Optional) <p>WriteToSecretRef is a reference to a secret</p>"},{"location":"api-specification/#identity-manager.io/v1alpha1.SyncKeySource","title":"SyncKeySource (<code>string</code> alias)","text":"<p> (Appears on: SyncKey) </p> <p> <p>A SyncKeySource indicates type of the azure resource keys to synced</p> </p> Value Description <p>\"Cosmos\"</p> <p>SyncKeySourceCosmos indicates azure resource type cosmos</p> <p>\"\"</p> <p>SyncKeySourceDefault indicates no resource type</p> <p>\"Storage\"</p> <p>SyncKeySourceStorage indicates azure resource type storage</p>"},{"location":"api-specification/#identity-manager.io/v1alpha1.WorkloadIdentity","title":"WorkloadIdentity","text":"<p> <p>WorkloadIdentity is the Schema for the workloadidentities API</p> </p> Field Description <code>metadata</code>  Kubernetes meta/v1.ObjectMeta   Refer to the Kubernetes API documentation for the fields of the <code>metadata</code> field.  <code>spec</code>  WorkloadIdentitySpec  <code>name</code>  string  (Optional) <p>Name of the WorkloadIdentity</p> <code>displayName</code>  string  (Optional) <p>DisplayName of the WorkloadIdentity</p> <code>description</code>  string  (Optional) <p>Desc of the WorkloadIdentity</p> <code>credentials</code>  Credentials  (Optional) <p>Credentials to manage the WorkloadIdentity</p> <code>provider</code>  Provider  <p>Provider of the WorkloadIdentity</p> <code>aws</code>  WorkloadIdentityAWS  (Optional) <p>AWS WorkloadIdentity</p> <code>azure</code>  WorkloadIdentityAzure  (Optional) <p>Azure WorkloadIdentity</p> <code>gcp</code>  WorkloadIdentityGCP  (Optional) <p>GCP WorkloadIdentity</p> <code>writeToSecretRef</code>  WriteToSecretRef  (Optional) <p>WriteToSecretRef is a reference to a secret</p> <code>tags</code>  map[string]string  (Optional) <p>Tags of WorkloadIdentity</p> <code>status</code>  WorkloadIdentityStatus"},{"location":"api-specification/#identity-manager.io/v1alpha1.WorkloadIdentityAWS","title":"WorkloadIdentityAWS","text":"<p> (Appears on: WorkloadIdentitySpec) </p> <p> <p>WorkloadIdentityAWS defines the spec for AWS Provider</p> </p> Field Description <code>path</code>  string  (Optional) <p>Path of the Role</p> <code>maxSessionDuration</code>  int64  (Optional) <p>MaxSessionDuration of the Role</p> <code>assumeRolePolicy</code>  string  <p>AssumeRolePolicy of the Role</p> <code>inlinePolicies</code>  map[string]string  (Optional) <p>InlinePolicies of the Role</p> <code>policies</code>  []string  (Optional) <p>Policies of the Role</p> <code>permissionsBoundaryARN</code>  string  (Optional) <p>PermissionsBoundaryARN of Role</p> <code>serviceAccounts</code>  []*github.com/invisibl-cloud/identity-manager/api/v1alpha1.ServiceAccount  (Optional) <p>ServiceAccounts to be managed</p> <code>pods</code>  []*github.com/invisibl-cloud/identity-manager/api/v1alpha1.PodSelector  (Optional) <p>Pods to be managed</p>"},{"location":"api-specification/#identity-manager.io/v1alpha1.WorkloadIdentityAzure","title":"WorkloadIdentityAzure","text":"<p> (Appears on: WorkloadIdentitySpec) </p> <p> <p>WorkloadIdentityAzure is the Provider spec for ProviderAzure</p> </p> Field Description <code>roleDefinitions</code>  []*github.com/invisibl-cloud/identity-manager/api/v1alpha1.RoleDefinition  (Optional) <p>RoleDefinitions is a list of role definitions</p> <code>roleAssignments</code>  map[string]github.com/invisibl-cloud/identity-manager/api/v1alpha1.RoleAssignment  (Optional) <p>RoleAssignments of the WorkloadIdentity</p> <code>identity</code>  AzureIdentity  (Optional) <p>Identity of the WorkloadIdentity</p> <code>identityBinding</code>  AzureIdentityBinding  (Optional) <p>IdentityBinding of the WorkloadIdentity</p> <code>syncKeys</code>  []*github.com/invisibl-cloud/identity-manager/api/v1alpha1.SyncKey  (Optional) <p>SyncKeys of the WorkloadIdentity</p>"},{"location":"api-specification/#identity-manager.io/v1alpha1.WorkloadIdentityGCP","title":"WorkloadIdentityGCP","text":"<p> (Appears on: WorkloadIdentitySpec) </p> <p> <p>WorkloadIdentityGCP is the Provider spec for ProviderGCP</p> </p> Field Description <code>roles</code>  []string  (Optional) <p>Roles to be assigned</p> <code>customRoles</code>  []GCPCustomRole  (Optional) <p>CustomRoles to be assigned</p> <code>serviceAccounts</code>  []*github.com/invisibl-cloud/identity-manager/api/v1alpha1.ServiceAccount  (Optional) <p>ServiceAccounts to be managed</p> <code>pods</code>  []*github.com/invisibl-cloud/identity-manager/api/v1alpha1.PodSelector  (Optional) <p>Pods to be managed</p>"},{"location":"api-specification/#identity-manager.io/v1alpha1.WorkloadIdentitySpec","title":"WorkloadIdentitySpec","text":"<p> (Appears on: WorkloadIdentity) </p> <p> <p>WorkloadIdentitySpec defines the desired state of WorkloadIdentity</p> </p> Field Description <code>name</code>  string  (Optional) <p>Name of the WorkloadIdentity</p> <code>displayName</code>  string  (Optional) <p>DisplayName of the WorkloadIdentity</p> <code>description</code>  string  (Optional) <p>Desc of the WorkloadIdentity</p> <code>credentials</code>  Credentials  (Optional) <p>Credentials to manage the WorkloadIdentity</p> <code>provider</code>  Provider  <p>Provider of the WorkloadIdentity</p> <code>aws</code>  WorkloadIdentityAWS  (Optional) <p>AWS WorkloadIdentity</p> <code>azure</code>  WorkloadIdentityAzure  (Optional) <p>Azure WorkloadIdentity</p> <code>gcp</code>  WorkloadIdentityGCP  (Optional) <p>GCP WorkloadIdentity</p> <code>writeToSecretRef</code>  WriteToSecretRef  (Optional) <p>WriteToSecretRef is a reference to a secret</p> <code>tags</code>  map[string]string  (Optional) <p>Tags of WorkloadIdentity</p>"},{"location":"api-specification/#identity-manager.io/v1alpha1.WorkloadIdentityStatus","title":"WorkloadIdentityStatus","text":"<p> (Appears on: WorkloadIdentity) </p> <p> <p>WorkloadIdentityStatus defines the observed state of WorkloadIdentity</p> </p> Field Description <code>ConditionedStatus</code>  ConditionedStatus  <p> (Members of <code>ConditionedStatus</code> are embedded into this type.) </p> <code>id</code>  string  (Optional) <p>ID of the Identity</p> <code>name</code>  string  (Optional) <p>Name of the Identity</p> <code>resources</code>  []Resource  (Optional) <p>Resources managed by the Identity</p> <code>externalResources</code>  []ExternalResource  (Optional) <p>External Resources managed bu the Identity</p>"},{"location":"api-specification/#identity-manager.io/v1alpha1.WriteToSecretRef","title":"WriteToSecretRef","text":"<p> (Appears on: SyncKey,  WorkloadIdentitySpec) </p> <p> <p>WriteToSecretRef is a reference to a secret</p> </p> Field Description <code>name</code>  string  <p>Name of the secret</p> <code>namespace</code>  string  (Optional) <p>Namespace of the secret</p> <code>templateData</code>  map[string]string  <p>TemplateData is a template for the data to be written to the secret</p> <p> Generated with <code>gen-crd-api-reference-docs</code>. </p>"},{"location":"contributing-coc/","title":"Code of Conduct","text":""},{"location":"contributing-coc/#our-pledge","title":"Our Pledge","text":"<p>We as members, contributors, and leaders pledge to make participation in our community a harassment-free experience for everyone, regardless of age, body size, visible or invisible disability, ethnicity, sex characteristics, gender identity and expression, level of experience, education, socio-economic status, nationality, personal appearance, race, caste, color, religion, or sexual identity and orientation.</p> <p>We pledge to act and interact in ways that contribute to an open, welcoming, diverse, inclusive, and healthy community.</p>"},{"location":"contributing-coc/#our-standards","title":"Our Standards","text":"<p>Examples of behavior that contributes to a positive environment for our community include:</p> <ul> <li>Demonstrating empathy and kindness toward other people</li> <li>Being respectful of differing opinions, viewpoints, and experiences</li> <li>Giving and gracefully accepting constructive feedback</li> <li>Accepting responsibility and apologizing to those affected by our mistakes,   and learning from the experience</li> <li>Focusing on what is best not just for us as individuals, but for the overall   community</li> </ul> <p>Examples of unacceptable behavior include:</p> <ul> <li>The use of sexualized language or imagery, and sexual attention or advances of   any kind</li> <li>Trolling, insulting or derogatory comments, and personal or political attacks</li> <li>Public or private harassment</li> <li>Publishing others' private information, such as a physical or email address,   without their explicit permission</li> <li>Other conduct which could reasonably be considered inappropriate in a   professional setting</li> </ul>"},{"location":"contributing-coc/#enforcement-responsibilities","title":"Enforcement Responsibilities","text":"<p>Community leaders are responsible for clarifying and enforcing our standards of acceptable behavior and will take appropriate and fair corrective action in response to any behavior that they deem inappropriate, threatening, offensive, or harmful.</p> <p>Community leaders have the right and responsibility to remove, edit, or reject comments, commits, code, wiki edits, issues, and other contributions that are not aligned to this Code of Conduct, and will communicate reasons for moderation decisions when appropriate.</p>"},{"location":"contributing-coc/#scope","title":"Scope","text":"<p>This Code of Conduct applies within all community spaces, and also applies when an individual is officially representing the community in public spaces. Examples of representing our community include using an official e-mail address, posting via an official social media account, or acting as an appointed representative at an online or offline event.</p>"},{"location":"contributing-coc/#enforcement","title":"Enforcement","text":"<p>Instances of abusive, harassing, or otherwise unacceptable behavior may be reported to the community leaders responsible for enforcement at [INSERT CONTACT METHOD]. All complaints will be reviewed and investigated promptly and fairly.</p> <p>All community leaders are obligated to respect the privacy and security of the reporter of any incident.</p>"},{"location":"contributing-coc/#enforcement-guidelines","title":"Enforcement Guidelines","text":"<p>Community leaders will follow these Community Impact Guidelines in determining the consequences for any action they deem in violation of this Code of Conduct:</p>"},{"location":"contributing-coc/#1-correction","title":"1. Correction","text":"<p>Community Impact: Use of inappropriate language or other behavior deemed unprofessional or unwelcome in the community.</p> <p>Consequence: A private, written warning from community leaders, providing clarity around the nature of the violation and an explanation of why the behavior was inappropriate. A public apology may be requested.</p>"},{"location":"contributing-coc/#2-warning","title":"2. Warning","text":"<p>Community Impact: A violation through a single incident or series of actions.</p> <p>Consequence: A warning with consequences for continued behavior. No interaction with the people involved, including unsolicited interaction with those enforcing the Code of Conduct, for a specified period of time. This includes avoiding interactions in community spaces as well as external channels like social media. Violating these terms may lead to a temporary or permanent ban.</p>"},{"location":"contributing-coc/#3-temporary-ban","title":"3. Temporary Ban","text":"<p>Community Impact: A serious violation of community standards, including sustained inappropriate behavior.</p> <p>Consequence: A temporary ban from any sort of interaction or public communication with the community for a specified period of time. No public or private interaction with the people involved, including unsolicited interaction with those enforcing the Code of Conduct, is allowed during this period. Violating these terms may lead to a permanent ban.</p>"},{"location":"contributing-coc/#4-permanent-ban","title":"4. Permanent Ban","text":"<p>Community Impact: Demonstrating a pattern of violation of community standards, including sustained inappropriate behavior, harassment of an individual, or aggression toward or disparagement of classes of individuals.</p> <p>Consequence: A permanent ban from any sort of public interaction within the community.</p>"},{"location":"contributing-coc/#attribution","title":"Attribution","text":"<p>This Code of Conduct is adapted from the Contributor Covenant, version 2.1, available at https://www.contributor-covenant.org/version/2/1/code_of_conduct.html.</p> <p>Community Impact Guidelines were inspired by Mozilla's code of conduct enforcement ladder.</p> <p>For answers to common questions about this code of conduct, see the FAQ at https://www.contributor-covenant.org/faq. Translations are available at https://www.contributor-covenant.org/translations.</p>"},{"location":"contributing-process/","title":"Contributing Process","text":""},{"location":"contributing-process/#project-management","title":"Project Management","text":"<p>The Code, our TODOs and Documentation is maintained on GitHub. All Issues should be opened in that repository.</p>"},{"location":"contributing-process/#issues","title":"Issues","text":"<p>Features, bugs and any issues regarding the documentation should be filed as GitHub Issue in our repository. We use labels like <code>kind/feature</code>, <code>kind/bug</code>, <code>area/aws</code> to organize the issues. Issues labeled <code>good first issue</code> and <code>help wanted</code> are especially good for a first contribution. If you want to pick up an issue just leave a comment.</p>"},{"location":"contributing-process/#creating-a-new-issue","title":"Creating a New Issue","text":"<p>If you've encountered an issue that is not already reported, please create an issue that contains the following:</p> <ul> <li>Clear description of the issue</li> <li>Steps to reproduce it</li> <li>Appropriate labels</li> </ul>"},{"location":"contributing-process/#building-and-testing-locally","title":"Building and testing locally","text":"<p>The project uses the <code>make</code> build system. It'll run code generators, tests and static code analysis.</p> <p>Building the operator binary and docker image:</p> <pre><code>make build\nmake docker-build IMG=identity-manager:latest\n</code></pre> <p>Run tests and lint the code: <pre><code>make test\nmake lint\n</code></pre></p>"},{"location":"contributing-process/#creating-a-pull-request","title":"Creating a Pull Request","text":"<p>Each new pull request should:</p> <ul> <li>Reference any related issues</li> <li>Add tests that show the issues have been solved</li> <li>Pass existing tests and linting</li> <li>Contain a clear indication of if they're ready for review or a work in progress</li> <li>Be up to date and/or rebased on the master branch</li> </ul>"},{"location":"developer-guide/","title":"Developer guide","text":""},{"location":"developer-guide/#getting-started","title":"Getting Started","text":"<p>You must have a working Go environment and then clone the repo:</p> <pre><code>git clone https://github.com/invisibl-cloud/identity-manager.git\ncd identity-manager\n</code></pre> <p>If you want to run controller tests you also need to install kubebuilder's <code>envtest</code>.</p> <p>The recommended way to do so is to install setup-envtest</p> <p>Here is an example on how to set it up:</p> <pre><code>go install sigs.k8s.io/controller-runtime/tools/setup-envtest@latest\n\n# list available versions\nsetup-envtest list --os $(go env GOOS) --arch $(go env GOARCH)\n\n# To use a specific version\nsetup-envtest use -p path 1.20.2\n\n#To set environment variables\nsource &lt;(setup-envtest use 1.20.2 -p env --os $(go env GOOS) --arch $(go env GOARCH))\n</code></pre> <p>for more information, please see setup-envtest docs</p>"},{"location":"developer-guide/#building-testing","title":"Building &amp; Testing","text":"<p>The project uses the <code>make</code> build system. It'll run code generators, tests and static code analysis.</p> <p>Building the operator binary and docker image:</p> <pre><code>make build\nmake docker-build IMG=identity-manager:latest\n</code></pre> <p>Run tests and lint the code: <pre><code>make test\nmake lint\n</code></pre></p>"},{"location":"developer-guide/#installing","title":"Installing","text":"<p>To install the Identity Manager Operator into a Kubernetes Cluster run:</p> <pre><code>helm repo add invisibl https://charts.invisibl.io\nhelm repo update\nhelm install identity-manager invisibl/identity-manager\n</code></pre> <p>You can alternatively run the controller on your host system for development purposes:</p> <pre><code>make install\nmake run\n</code></pre>"},{"location":"developer-guide/#deploy-workloadidentity","title":"Deploy WorkloadIdentity","text":""},{"location":"developer-guide/#create-a-secret-containing-your-aws-credentials","title":"Create a secret containing your AWS credentials","text":"<pre><code>echo -n 'KEYID' &gt; ./access-key\necho -n 'SECRETKEY' &gt; ./secret-access-key\necho -n 'REGION' &gt; ./region\nkubectl create secret generic aws-credentials --from-file=./access-key  --from-file=./secret-access-key --from-file=./region\n</code></pre>"},{"location":"developer-guide/#apply-workload-identity","title":"Apply Workload Identity","text":"<p>Save the following workload identity yaml in <code>workload-identity.yaml</code>.</p> <pre><code>\n</code></pre> <p>Once the workload identity is applied, an IAM role will be created in AWS with the policies attached to the role.</p> <p>To remove the CRDs run:</p> <pre><code>make uninstall\n</code></pre>"},{"location":"developer-guide/#documentation","title":"Documentation","text":"<p>We use mkdocs material to generate this documentation. See <code>/docs</code> for the source code.</p> <p>When writing documentation it is advised to run the mkdocs server with live reload:</p> <pre><code>mkdocs serve\n</code></pre> <p>Open <code>http://localhost:8000</code> in your browser.</p>"},{"location":"guides-getting-started/","title":"Getting started","text":"<p>This guide helps you to setup the cluster, install Identity Manager, deploy a workload identity and verify the working with a demo application. The following installation steps are applicable for AWS EKS cluster.</p> <p>Note: The minimum supported version of Kubernetes is <code>1.16.0</code>.</p>"},{"location":"guides-getting-started/#prerequisites","title":"Prerequisites","text":"<p>The following tools are needed to be installed in your system:</p> <ol> <li><code>Helm</code> - To install the Identity Manager</li> <li><code>kubectl</code> - To connect with kubernetes cluster</li> </ol>"},{"location":"guides-getting-started/#working-with-an-existing-cluster","title":"Working with an existing cluster","text":"<p>For an existing cluster, a new namespace, a service account and an IAM role need to be created. A few policies that the Identity Manager needs for its working need to be attached to the newly created role.</p> <ol> <li> <p>Create the namespace and service account <pre><code>kubectl create namespace identity-manager\nkubectl create serviceaccount identity-manager -n identity-manager\n</code></pre></p> </li> <li> <p>Export the required environment values: <pre><code>export ACCOUNT_ID=$(aws sts get-caller-identity --query \"Account\" --output text)\n\nexport OIDC_PROVIDER=$(aws eks describe-cluster --name &lt;cluster-name&gt; --query \"cluster.identity.oidc.issuer\" --region &lt;region&gt; --output text | sed -e \"s/^https:\\/\\///\")\n\nexport NAMESPACE=identity-manager\nexport SERVICEACCNAME=identity-manager\nexport ROLENAME=identity-manager\n</code></pre></p> </li> <li> <p>Save the required IAM polices: <pre><code>read -r -d '' IDENTITY_POLICIES &lt;&lt;EOF\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Action\": [\n                \"iam:AttachRolePolicy\",\n                \"iam:CreateRole\",\n                \"iam:DeleteRole\",\n                \"iam:DeleteRolePolicy\",\n                \"iam:DetachRolePolicy\",\n                \"iam:GetRole\",\n                \"iam:ListAttachedRolePolicies\",\n                \"iam:ListRolePolicies\",\n                \"iam:PutRolePolicy\",\n                \"iam:UpdateAssumeRolePolicy\",\n                \"iam:UpdateRole\",\n                \"sts:GetCallerIdentity\"\n            ],\n            \"Resource\": \"*\",\n            \"Effect\": \"Allow\"\n        }\n    ]\n}\nEOF\necho \"${IDENTITY_POLICIES}\" &gt; identity-policies.json\n</code></pre></p> </li> <li> <p>Save the trust relationship <pre><code>read -r -d '' TRUST_RELATIONSHIP &lt;&lt;EOF\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Principal\": {\n        \"Federated\": \"arn:aws:iam::${ACCOUNT_ID}:oidc-provider/${OIDC_PROVIDER}\"\n      },\n      \"Action\": \"sts:AssumeRoleWithWebIdentity\",\n      \"Condition\": {\n        \"StringEquals\": {\n          \"${OIDC_PROVIDER}:aud\": \"sts.amazonaws.com\",\n          \"${OIDC_PROVIDER}:sub\": \"system:serviceaccount:${NAMESPACE}:${SERVICEACCNAME}\"\n        }\n      }\n    }\n  ]\n}\nEOF\necho \"${TRUST_RELATIONSHIP}\" &gt; trust.json\n</code></pre></p> </li> <li> <p>Create the IAM role: <pre><code>aws iam create-role --role-name ${ROLENAME} --assume-role-policy-document file://trust.json --description \"identity-role\"\n</code></pre> Note down the IAM role ARN in the response.</p> </li> <li> <p>Attach the IAM policies to the role: <pre><code>aws iam put-role-policy --role-name ${ROLENAME} --policy-name identity-policy --policy-document file://identity-policies.json\n</code></pre></p> </li> <li> <p>Annotate the service account with the IAM role ARN that was noted in the step 5. <pre><code>kubectl annotate serviceaccount -n identity-manager identity-manager \\\neks.amazonaws.com/role-arn=&lt;ROLE ARN&gt;\n</code></pre></p> </li> </ol> <p>At this point, the setup of the service account <code>identity-manager</code> is finished and is ready for the Identity Manager installation.</p>"},{"location":"guides-getting-started/#installing-identity-manager-with-helm","title":"Installing Identity Manager with Helm","text":"<ol> <li>Copy the newly created IAM role ARN and create an environment variable: <pre><code>export IAM_ROLE=&lt;IAM role ARN&gt;\n</code></pre></li> <li>Install Identity Manager <pre><code>helm repo add invisibl https://charts.invisibl.io\n\nhelm install my-identity-manager invisibl/identity-manager  --set provider.aws.enabled=true --set provider.aws.arn=$IAM_ROLE --set serviceAccount.create=false --set serviceAccount.name=identity-manager --namespace=identity-manager\n</code></pre></li> </ol> <p>The above command will install Identity Manager in <code>identity-manager</code> namespace and <code>identity-manager</code> service account. This service account is annotated to the IAM role that has the necessary IAM permissions for the Identity Manager. This service account is dedicated to Identity Manager and any workload identity should be deployed in other service accounts.</p>"},{"location":"guides-getting-started/#deploying-demo-application","title":"Deploying demo application","text":"<ol> <li> <p>Get your AWS account ID <pre><code>export ACCOUNT_ID=$(aws sts get-caller-identity --query \"Account\" --output text)\n</code></pre></p> </li> <li> <p>Get your OIDC provider <pre><code>export OIDC_PROVIDER=$(aws eks describe-cluster --name &lt;cluster name&gt; --query \"cluster.identity.oidc.issuer\" --region &lt;region&gt; --output text | sed -e \"s/^https:\\/\\///\")\n</code></pre></p> </li> <li> <p>Deploy demo application <pre><code>helm install my-identity-manager-demo invisibl/identity-manager-demo --set serviceAccount.name=sa-demo --namespace=demo --set  workloadIdentity.aws.accountId=${ACCOUNT_ID} --set workloadIdentity.aws.oidcProvider=${OIDC_PROVIDER} --create-namespace\n</code></pre> The above command will deploy the workload identity and a demo application in the namespace <code>demo</code>. The identity manager will create an IAM role <code>my-identity-manager-demo</code> in AWS with the inline polices mentioned in the workload identity attached to the IAM role. The identity manager will also create a service account <code>sa-demo</code> and will annotate it with the newly created role to facilitate the role binding.</p> </li> <li> <p>Verify the role binding for service account <pre><code>kubectl get serviceaccount sa-demo -n demo  -o=jsonpath='{.metadata.annotations}'\n</code></pre> The response should look similar to the below one: <pre><code>{\"eks.amazonaws.com/role-arn\":\"arn:aws:iam::&lt;Account ID&gt;:role/my-identity-manager-demo\"}\n</code></pre></p> </li> <li>Check the logs of the demo application pod and it should list your EC2 instances using the new role  <code>my-identity-manager-demo</code>. <pre><code>time=\"2022-05-04T09:54:04Z\" level=info msg=\"STS:\"\ntime=\"2022-05-04T09:54:04Z\" level=info msg=\"STS ARN: arn:aws:sts::&lt;Account ID&gt;:assumed-role/my-identity-manager-demo/48520678505362540620424\"\ntime=\"2022-05-04T09:54:04Z\" level=info msg=\"EC2:\"\ntime=\"2022-05-04T09:54:04Z\" level=info msg=\"Reservation ID: r-0532a81dd8ed78de1\"\ntime=\"2022-05-04T09:54:04Z\" level=info msg=\"Instance ID: i-078e85384f15b27b9\"\ntime=\"2022-05-04T09:54:04Z\" level=info msg=\"Reservation ID: r-0ec5be0a1e1017088\"\ntime=\"2022-05-04T09:54:04Z\" level=info msg=\"Instance ID: i-0efee718f18c10742\"\ntime=\"2022-05-04T09:54:04Z\" level=info msg=\"Reservation ID: r-0992e8b92ae857ddd\"\ntime=\"2022-05-04T09:54:04Z\" level=info msg=\"Instance ID: i-097b6eb735190898c\"\ntime=\"2022-05-04T09:54:04Z\" level=info msg=\"Reservation ID: r-0f7c4e3a8d62c0af7\"\ntime=\"2022-05-04T09:54:04Z\" level=info msg=\"Instance ID: i-09e2a542b827858de\"\ntime=\"2022-05-04T09:54:04Z\" level=info msg=\"Instance ID: i-0c77422d4e56c42c9\"\ntime=\"2022-05-04T09:54:04Z\" level=info msg=\"Reservation ID: r-0265da1370d12b44d\"\ntime=\"2022-05-04T09:54:04Z\" level=info msg=\"Instance ID: i-05d02af34a271e308\"   time=\"2022-05-04T09:54:04Z\" level=info msg=\"Reservation ID: r-0efa1b0178917b544\"\ntime=\"2022-05-04T09:54:04Z\" level=info msg=\"Instance ID: i-04027edd12c82f6d6\"\ntime=\"2022-05-04T09:54:04Z\" level=info msg=\"Reservation ID: r-0b0d08c57fb60bb71\"\ntime=\"2022-05-04T09:54:04Z\" level=info msg=\"Instance ID: i-09d4114c468def93e\"\ntime=\"2022-05-04T09:54:04Z\" level=info msg=\"Reservation ID: r-09e8cc98f64abef83\"\ntime=\"2022-05-04T09:54:04Z\" level=info msg=\"Instance ID: i-0bc14ad13ef223d76\"\ntime=\"2022-05-04T09:54:04Z\" level=info\ntime=\"2022-05-04T09:54:04Z\" level=info msg=\"Reservations count: 8\"\ntime=\"2022-05-04T09:54:04Z\" level=info msg=\"Instances count: 9\"\n</code></pre></li> </ol>"},{"location":"guides-getting-started/#uninstalling-demo-application-with-helm","title":"Uninstalling demo application with Helm","text":"<pre><code>helm uninstall my-identity-manager-demo -n demo\n</code></pre>"},{"location":"guides-getting-started/#uninstalling-identity-manager-with-helm","title":"Uninstalling Identity Manager with Helm","text":"<pre><code>helm uninstall my-identity-manager -n identity-manager\n</code></pre>"},{"location":"guides-getting-started/#troubleshooting","title":"Troubleshooting","text":"<ol> <li>Identity Manager maintains the most recent log message in the <code>Status</code> field of the workload identity. In rare cases where the pods are failing to authenticate to the AWS services, the workload identity's <code>Status</code> fields can be queried to view the log which helps in debugging. <pre><code>kubectl get workloadidentity my-identity-manager-demo -n demo -o yaml\n</code></pre></li> <li>If there are no error log message found in the <code>Status</code> field of the workload identity, it is worth checking if the namespace and the service account defined in the workload identity matches the trust policy in the <code>aws.assumeRolePolicy</code>. The following is an simple example template of the trust policy: <pre><code>{\n\"Version\": \"2012-10-17\",\n\"Statement\": [\n{\n\"Effect\": \"Allow\",\n\"Principal\": {\n\"Federated\": \"arn:aws:iam::454135189203:oidc-provider/oidc.eks.us-east-1.amazonaws.com/id/33FC4D52E1241A120425308D0853F923A\"\n},\n\"Action\": \"sts:AssumeRoleWithWebIdentity\",\n\"Condition\": {\n\"StringEquals\": {\n\"oidc.eks.us-east-1.amazonaws.com/id/33FC4D52E1241A120425308D0853F923A:sub\": \"system:serviceaccount:&lt;namespace&gt;:&lt;service account&gt;\"\n}\n}\n}\n]\n}\n</code></pre></li> </ol>"},{"location":"guides-introduction/","title":"Guides","text":"<p>The following guides demonstrate use-cases and provide examples of how to use the API. Please pick one of the following guides:</p> <ul> <li>Getting started</li> <li>Developer guide</li> </ul>"},{"location":"guides-quick-start/","title":"Quick start","text":"<p>This guide helps you to setup the cluster, install Identity Manager, deploy a workload identity and verify the working of the Identity Manager with a demo application. The following installation steps are applicable for AWS EKS cluster.</p> <p>Note: If you already have a cluster setup ready, you can refer to the Getting started guide.</p>"},{"location":"guides-quick-start/#prerequisites","title":"Prerequisites","text":"<p>The following tools are needed to be installed in your system:</p> <ol> <li><code>eksctl</code> - To create a cluster in AWS EKS</li> <li><code>Helm</code> - To install the Identity Manager</li> <li><code>kubectl</code> - To connect with kubernetes cluster</li> </ol>"},{"location":"guides-quick-start/#create-an-eks-cluster","title":"Create an EKS cluster","text":"<p>The following instructions allows you to create a cluster in AWS EKS. They also takes care of creation of a namespace, service account and creation of a role with the IAM policies that are required by the Identity Manager and binds the role to the service account that is to be created.</p> <ol> <li>The following eks config file helps you to create a cluster with the required IAM role and policies, an m5.large node in the <code>us-east-1</code> region. The mentioned policies are the minimum required permissions for Identity Manager. You can change the other config as per your preference. Save the following yaml as <code>eks-identity-manager.yaml</code>. <pre><code>\n</code></pre></li> <li>Create the cluster using eksctl: <code>eksctl create cluster -f eks-identity-manager.yaml</code></li> </ol> <p>This will create an EKS cluster with the specified spec.</p>"},{"location":"guides-quick-start/#installing-identity-manager-with-helm","title":"Installing Identity Manager with Helm","text":"<ol> <li>Copy the cluster's IAM role:  If the cluster is newly created using <code>eksctl</code>, copy the IAM role ARN of the cluster from CloudFormation template. The IAM role can be found in the annotation of the service account <code>identity-manager</code>. <pre><code>export IAM_ROLE=&lt;IAM role&gt;\n</code></pre></li> <li>Install Identity Manager <pre><code>helm repo add invisibl https://charts.invisibl.io\n\nhelm install my-identity-manager invisibl/identity-manager  --set provider.aws.enabled=true --set provider.aws.arn=$IAM_ROLE --set serviceAccount.create=false --set serviceAccount.name=identity-manager --namespace=identity-manager\n</code></pre></li> </ol> <p>The above command will install Identity Manager in <code>identity-manager</code> namespace and <code>identity-manager</code> service account. This service account is annotated to the IAM role that has the necessary IAM permissions for the Identity Manager. This service account is dedicated to Identity Manager and any workload identity should be deployed in another service accounts.</p>"},{"location":"guides-quick-start/#deploying-demo-application","title":"Deploying demo application","text":"<ol> <li> <p>Get your AWS account ID <pre><code>export ACCOUNT_ID=$(aws sts get-caller-identity --query \"Account\" --output text)\n</code></pre></p> </li> <li> <p>Get your OIDC provider <pre><code>export OIDC_PROVIDER=$(aws eks describe-cluster --name identity-manager-test --query \"cluster.identity.oidc.issuer\" --region us-east-1 --output text | sed -e \"s/^https:\\/\\///\")\n</code></pre></p> </li> <li> <p>Deploy demo application <pre><code>helm install my-identity-manager-demo invisibl/identity-manager-demo --set serviceAccount.name=sa-demo --namespace=demo --set  workloadIdentity.aws.accountId=${ACCOUNT_ID} --set workloadIdentity.aws.oidcProvider=${OIDC_PROVIDER} --create-namespace\n</code></pre> The above command will deploy the workload identity and a demo application in the namespace <code>demo</code>. The identity manager will create an IAM role <code>my-identity-manager-demo</code> in AWS with the inline polices mentioned in the workload identity attached to the IAM role. The identity manager will also create a service account <code>sa-demo</code> and will annotate it with the newly created role to facilitate the role binding.</p> </li> <li> <p>Verify the role binding for service account <pre><code>kubectl get serviceaccount sa-demo -n demo  -o=jsonpath='{.metadata.annotations}'\n</code></pre> The response should look similar to the below one: <pre><code>{\"eks.amazonaws.com/role-arn\":\"arn:aws:iam::&lt;Account ID&gt;:role/my-identity-manager-demo\"}\n</code></pre></p> </li> <li>Check the logs of the demo application pod and it should list your EC2 instances using the new role  <code>my-identity-manager-demo</code>. <pre><code>time=\"2022-05-04T09:54:04Z\" level=info msg=\"STS:\"\ntime=\"2022-05-04T09:54:04Z\" level=info msg=\"STS ARN: arn:aws:sts::&lt;Account ID&gt;:assumed-role/my-identity-manager-demo/48520678505362540620424\"\ntime=\"2022-05-04T09:54:04Z\" level=info msg=\"EC2:\"\ntime=\"2022-05-04T09:54:04Z\" level=info msg=\"Reservation ID: r-0532a81dd8ed78de1\"\ntime=\"2022-05-04T09:54:04Z\" level=info msg=\"Instance ID: i-078e85384f15b27b9\"\ntime=\"2022-05-04T09:54:04Z\" level=info msg=\"Reservation ID: r-0ec5be0a1e1017088\"\ntime=\"2022-05-04T09:54:04Z\" level=info msg=\"Instance ID: i-0efee718f18c10742\"\ntime=\"2022-05-04T09:54:04Z\" level=info msg=\"Reservation ID: r-0992e8b92ae857ddd\"\ntime=\"2022-05-04T09:54:04Z\" level=info msg=\"Instance ID: i-097b6eb735190898c\"\ntime=\"2022-05-04T09:54:04Z\" level=info msg=\"Reservation ID: r-0f7c4e3a8d62c0af7\"\ntime=\"2022-05-04T09:54:04Z\" level=info msg=\"Instance ID: i-09e2a542b827858de\"\ntime=\"2022-05-04T09:54:04Z\" level=info msg=\"Instance ID: i-0c77422d4e56c42c9\"\ntime=\"2022-05-04T09:54:04Z\" level=info msg=\"Reservation ID: r-0265da1370d12b44d\"\ntime=\"2022-05-04T09:54:04Z\" level=info msg=\"Instance ID: i-05d02af34a271e308\"   time=\"2022-05-04T09:54:04Z\" level=info msg=\"Reservation ID: r-0efa1b0178917b544\"\ntime=\"2022-05-04T09:54:04Z\" level=info msg=\"Instance ID: i-04027edd12c82f6d6\"\ntime=\"2022-05-04T09:54:04Z\" level=info msg=\"Reservation ID: r-0b0d08c57fb60bb71\"\ntime=\"2022-05-04T09:54:04Z\" level=info msg=\"Instance ID: i-09d4114c468def93e\"\ntime=\"2022-05-04T09:54:04Z\" level=info msg=\"Reservation ID: r-09e8cc98f64abef83\"\ntime=\"2022-05-04T09:54:04Z\" level=info msg=\"Instance ID: i-0bc14ad13ef223d76\"\ntime=\"2022-05-04T09:54:04Z\" level=info\ntime=\"2022-05-04T09:54:04Z\" level=info msg=\"Reservations count: 8\"\ntime=\"2022-05-04T09:54:04Z\" level=info msg=\"Instances count: 9\"\n</code></pre></li> </ol>"},{"location":"guides-quick-start/#uninstalling-demo-application-with-helm","title":"Uninstalling demo application with Helm","text":"<pre><code>helm uninstall my-identity-manager-demo -n demo\n</code></pre>"},{"location":"guides-quick-start/#uninstalling-identity-manager-with-helm","title":"Uninstalling Identity Manager with Helm","text":"<pre><code>helm uninstall my-identity-manager -n identity-manager\n</code></pre>"}]}